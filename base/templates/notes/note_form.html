<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ action }} Note</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --danger-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            --info-gradient: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            --dark-bg: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-light: #e2e8f0;
            --card-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark-bg);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            color: var(--text-light);
            overflow-x: hidden;
        }

        /* Animated background particles */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="25" height="25" patternUnits="userSpaceOnUse"><circle cx="12.5" cy="12.5" r="1.5" fill="rgba(255,255,255,0.08)"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            animation: float 30s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-25px) rotate(180deg); }
        }

        .form-container {
            padding: 2rem 0;
            min-height: 100vh;
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modern-navbar {
            background: var(--glass-bg) !important;
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
            margin-bottom: 3rem;
        }

        .modern-navbar .navbar-brand {
            font-weight: 800;
            font-size: 1.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .modern-navbar .nav-link {
            color: var(--text-light) !important;
            font-weight: 600;
            padding: 0.75rem 1.5rem !important;
            border-radius: 50px;
            transition: all 0.3s ease;
            margin: 0 0.25rem;
        }

        .modern-navbar .nav-link:hover {
            background: var(--glass-bg);
            color: white !important;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .modern-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: var(--card-shadow);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            overflow: hidden;
            position: relative;
            margin-bottom: 2rem;
        }

        .modern-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 35px 70px rgba(0, 0, 0, 0.3);
        }

        .modern-card-header {
            background: var(--primary-gradient);
            padding: 2rem;
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .modern-card-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid2" width="15" height="15" patternUnits="userSpaceOnUse"><path d="M 15 0 L 0 0 0 15" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid2)"/></svg>');
            opacity: 0.3;
        }

        .modern-card-header h5 {
            position: relative;
            z-index: 1;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .modern-card-body {
            padding: 3rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .modern-form-group {
            margin-bottom: 2rem;
            position: relative;
        }

        .modern-form-label {
            color: white;
            font-weight: 700;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .modern-form-label i {
            color: #667eea;
            font-size: 1.1rem;
        }

        .required-asterisk {
            color: #ff9a9e;
            font-weight: 800;
            margin-left: 0.25rem;
        }

        .modern-input, .modern-select, .modern-textarea {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            color: white;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            backdrop-filter: blur(10px);
            width: 100%;
            position: relative;
        }

        .modern-input:focus, .modern-select:focus, .modern-textarea:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .modern-input::placeholder, .modern-textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .modern-textarea {
            min-height: 150px;
            resize: vertical;
            font-family: inherit;
            line-height: 1.6;
        }

        .form-text {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-text a {
            color: #4facfe;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .form-text a:hover {
            color: #00f2fe;
            text-shadow: 0 0 8px rgba(79, 172, 254, 0.5);
        }

        .invalid-feedback {
            color: #ff9a9e;
            font-weight: 600;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .invalid-feedback::before {
            content: '\f06a';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
        }

        .alert {
            background: var(--danger-gradient);
            border: none;
            border-radius: 16px;
            color: white;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px rgba(255, 154, 158, 0.3);
        }

        .modern-btn {
            padding: 1rem 2rem;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.95rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border: 2px solid;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
        }

        .modern-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }

        .modern-btn:hover::before {
            left: 100%;
        }

        .modern-btn:hover {
            transform: translateY(-3px) scale(1.05);
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary-gradient);
            border-color: rgba(102, 126, 234, 0.5);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
            color: white;
        }

        .btn-outline-secondary {
            background: transparent;
            border-color: rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.9);
        }

        .btn-outline-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.2);
        }

        .btn-outline-info {
            background: transparent;
            border-color: rgba(168, 237, 234, 0.5);
            color: #a8edea;
        }

        .btn-outline-info:hover {
            background: var(--info-gradient);
            border-color: transparent;
            color: white;
            box-shadow: 0 8px 25px rgba(168, 237, 234, 0.4);
        }

        .file-info {
            background: rgba(79, 172, 254, 0.2);
            border: 1px solid rgba(79, 172, 254, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
        }

        .file-info:hover {
            background: rgba(79, 172, 254, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.2);
        }

        .file-info a {
            color: #4facfe;
            font-weight: 600;
            text-decoration: none;
        }

        .file-info a:hover {
            color: #00f2fe;
            text-shadow: 0 0 8px rgba(79, 172, 254, 0.5);
        }

        .character-counter {
            position: absolute;
            bottom: 1rem;
            right: 1.5rem;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .character-counter.warning {
            background: var(--warning-gradient);
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .tips-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
            position: relative;
            animation: slideInUp 0.8s ease-out 0.3s both;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tips-card-header {
            background: var(--info-gradient);
            padding: 1.5rem 2rem;
            color: white;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .tips-card-body {
            padding: 2rem;
        }

        .tip-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tip-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .tip-item h6 {
            color: white;
            font-weight: 700;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tip-item h6 i {
            color: #4facfe;
        }

        .tip-item p {
            color: rgba(255, 255, 255, 0.8);
            margin: 0;
            line-height: 1.5;
        }

        .file-upload-area {
            position: relative;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
        }

        .file-upload-area:hover {
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(102, 126, 234, 0.1);
        }

        .file-upload-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.2);
            transform: scale(1.02);
        }

        #fileSizeInfo {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        #fileSizeInfo.text-success {
            background: rgba(79, 172, 254, 0.2);
            border: 1px solid rgba(79, 172, 254, 0.3);
            color: #00f2fe;
        }

        #fileSizeInfo.text-danger {
            background: rgba(255, 154, 158, 0.2);
            border: 1px solid rgba(255, 154, 158, 0.3);
            color: #ff9a9e;
        }

        /* Auto-save indicator */
        .auto-save-indicator {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: var(--success-gradient);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.875rem;
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .auto-save-indicator.show {
            transform: translateX(0);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .form-container {
                padding: 1rem 0;
            }

            .modern-card-body {
                padding: 2rem 1.5rem;
            }

            .modern-btn {
                padding: 0.875rem 1.5rem;
                font-size: 0.875rem;
                width: 100%;
                justify-content: center;
                margin-bottom: 0.75rem;
            }

            .d-flex.justify-content-between {
                flex-direction: column;
                gap: 1rem;
            }

            .d-flex.justify-content-between > div {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }

            .character-counter {
                position: static;
                margin-top: 0.5rem;
                align-self: flex-end;
            }
        }

        /* Loading animation */
        .loading-btn {
            position: relative;
            pointer-events: none;
            opacity: 0.8;
        }

        .loading-btn::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
        }

        @keyframes spin {
            from { transform: translateY(-50%) rotate(0deg); }
            to { transform: translateY(-50%) rotate(360deg); }
        }

        /* Custom file input styling */
        .custom-file-input {
            opacity: 0;
            position: absolute;
            z-index: -1;
        }

        .custom-file-label {
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            color: rgba(255, 255, 255, 0.8);
        }

        .custom-file-label:hover {
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(102, 126, 234, 0.1);
            color: white;
        }

        .custom-file-label i {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #667eea;
        }
    </style>
</head>
<body class="form-container">
    <div class="container-fluid">
        <!-- Modern Header -->
        <div class="row">
            <div class="col-12">
                <nav class="navbar navbar-expand-lg modern-navbar">
                    <div class="container-fluid">
                        <a class="navbar-brand" href="{% url 'notes_dashboard' %}">
                            <i class="fas fa-sticky-note"></i> {{ action }} Note
                        </a>
                        <div class="navbar-nav ms-auto">
                            <a class="nav-link" href="{% url 'notes_dashboard' %}">
                                <i class="fas fa-arrow-left"></i> Back to Notes
                            </a>
                            <a class="nav-link" href="{% url 'dashboard' %}">
                                <i class="fas fa-home"></i> Dashboard
                            </a>
                        </div>
                    </div>
                </nav>
            </div>
        </div>

        <!-- Form Content -->
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-8">
                <div class="modern-card">
                    <div class="modern-card-header">
                        <h5>
                            <i class="fas fa-{% if action == 'Create' %}plus{% else %}edit{% endif %}"></i> 
                            {{ title|default:action }} Note
                        </h5>
                    </div>
                    <div class="modern-card-body">
                        <!-- Display Form Errors -->
                        {% if form.non_field_errors %}
                            <div class="alert">
                                <i class="fas fa-exclamation-triangle"></i>
                                {{ form.non_field_errors }}
                            </div>
                        {% endif %}

                        <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                            {% csrf_token %}
                            
                            <div class="row">
                                <!-- Note List Selection -->
                                <div class="col-md-6">
                                    <div class="modern-form-group">
                                        <label for="{{ form.note_list.id_for_label }}" class="modern-form-label">
                                            <i class="fas fa-folder"></i> {{ form.note_list.label }}
                                        </label>
                                        <select id="{{ form.note_list.id_for_label }}" name="{{ form.note_list.name }}" class="modern-select">
                                            {% for choice in form.note_list %}
                                                {{ choice }}
                                            {% endfor %}
                                        </select>
                                        {% if form.note_list.errors %}
                                            <div class="invalid-feedback d-block">
                                                {{ form.note_list.errors.0 }}
                                            </div>
                                        {% endif %}
                                        <div class="form-text">
                                            <i class="fas fa-info-circle"></i>
                                            <a href="{% url 'note_list_create' %}">
                                                <i class="fas fa-plus"></i> Create new list
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Creation Date -->
                                <div class="col-md-6">
                                    <div class="modern-form-group">
                                        <label for="{{ form.creation_date.id_for_label }}" class="modern-form-label">
                                            <i class="fas fa-calendar-plus"></i> {{ form.creation_date.label }}
                                        </label>
                                        <input type="date" id="{{ form.creation_date.id_for_label }}" name="{{ form.creation_date.name }}" class="modern-input" value="{{ form.creation_date.value|default:'' }}">
                                        {% if form.creation_date.errors %}
                                            <div class="invalid-feedback d-block">
                                                {{ form.creation_date.errors.0 }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Note Heading -->
                            <div class="modern-form-group">
                                <label for="{{ form.heading.id_for_label }}" class="modern-form-label">
                                    <i class="fas fa-heading"></i> {{ form.heading.label }} 
                                    <span class="required-asterisk">*</span>
                                </label>
                                <input type="text" id="{{ form.heading.id_for_label }}" name="{{ form.heading.name }}" class="modern-input" placeholder="Enter a compelling heading for your note..." value="{{ form.heading.value|default:'' }}" required>
                                {% if form.heading.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.heading.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Note Content -->
                            <div class="modern-form-group" style="position: relative;">
                                <label for="{{ form.content.id_for_label }}" class="modern-form-label">
                                    <i class="fas fa-align-left"></i> {{ form.content.label }} 
                                    <span class="required-asterisk">*</span>
                                </label>
                                <textarea id="{{ form.content.id_for_label }}" name="{{ form.content.name }}" class="modern-textarea" placeholder="Write your note content here. Be detailed and organized..." required>{{ form.content.value|default:'' }}</textarea>
                                <div class="character-counter" id="contentCounter">0 characters</div>
                                {% if form.content.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.content.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="row">
                                <!-- Reminder Date -->
                                <div class="col-md-6">
                                    <div class="modern-form-group">
                                        <label for="{{ form.reminder_date.id_for_label }}" class="modern-form-label">
                                            <i class="fas fa-bell"></i> {{ form.reminder_date.label }}
                                        </label>
                                        <input type="datetime-local" id="{{ form.reminder_date.id_for_label }}" name="{{ form.reminder_date.name }}" class="modern-input" value="{{ form.reminder_date.value|default:'' }}">
                                        {% if form.reminder_date.errors %}
                                            <div class="invalid-feedback d-block">
                                                {{ form.reminder_date.errors.0 }}
                                            </div>
                                        {% endif %}
                                        <div class="form-text">
                                            <i class="fas fa-info-circle"></i>
                                            Optional reminder for future action
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Due Date -->
                                <div class="col-md-6">
                                    <div class="modern-form-group">
                                        <label for="{{ form.due_date.id_for_label }}" class="modern-form-label">
                                            <i class="fas fa-calendar-check"></i> {{ form.due_date.label }}
                                        </label>
                                        <input type="date" id="{{ form.due_date.id_for_label }}" name="{{ form.due_date.name }}" class="modern-input" value="{{ form.due_date.value|default:'' }}">
                                        {% if form.due_date.errors %}
                                            <div class="invalid-feedback d-block">
                                                {{ form.due_date.errors.0 }}
                                            </div>
                                        {% endif %}
                                        <div class="form-text">
                                            <i class="fas fa-info-circle"></i>
                                            Final completion deadline
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- File Attachment -->
                            <div class="modern-form-group">
                                <label for="{{ form.attachment.id_for_label }}" class="modern-form-label">
                                    <i class="fas fa-paperclip"></i> {{ form.attachment.label }}
                                </label>
                                
                                <div class="file-upload-area" id="fileUploadArea">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <h6 style="color: white; margin: 1rem 0;">Drag & Drop or Click to Upload</h6>
                                    <input type="file" id="{{ form.attachment.id_for_label }}" name="{{ form.attachment.name }}" class="custom-file-input" accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.xlsx,.xls">
                                    <label for="{{ form.attachment.id_for_label }}" class="custom-file-label">
                                        <div>
                                            <i class="fas fa-upload"></i>
                                            <div style="margin-top: 0.5rem;">Choose File</div>
                                        </div>
                                    </label>
                                </div>
                                
                                {% if form.attachment.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.attachment.errors.0 }}
                                    </div>
                                {% endif %}
                                
                                <div class="form-text">
                                    <i class="fas fa-info-circle"></i>
                                    Supported formats: PDF, DOC, DOCX, TXT, JPG, JPEG, PNG, XLSX, XLS (Max: 500KB)
                                </div>
                                
                                <!-- Current file info -->
                                {% if note and note.attachment %}
                                    <div class="file-info">
                                        <i class="fas fa-file"></i>
                                        <div>
                                            <strong>Current file:</strong> 
                                            <a href="{{ note.attachment.url }}" target="_blank">
                                                {{ note.attachment.name|cut:"notes/"|cut:note.user.id|cut:"/" }}
                                            </a>
                                            <small class="text-muted">({{ note.attachment.size|filesizeformat }})</small>
                                        </div>
                                    </div>
                                {% endif %}

                                <!-- File size indicator -->
                                <div id="fileSizeInfo" style="display: none;">
                                    <span id="fileSizeText"></span>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="d-flex justify-content-between align-items-center mt-4">
                                <a href="{% url 'notes_dashboard' %}" class="modern-btn btn-outline-secondary">
                                    <i class="fas fa-arrow-left"></i> Cancel
                                </a>
                                
                                <div>
                                    {% if note %}
                                        <a href="{% url 'note_detail' note.pk %}" class="modern-btn btn-outline-info me-3">
                                            <i class="fas fa-eye"></i> View Note
                                        </a>
                                    {% endif %}
                                    <button type="submit" class="modern-btn btn-primary" id="submitBtn">
                                        <i class="fas fa-save"></i> {{ action }} Note
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Modern Quick Tips -->
                <div class="tips-card">
                    <div class="tips-card-header">
                        <i class="fas fa-lightbulb"></i> Pro Tips
                    </div>
                    <div class="tips-card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="tip-item">
                                    <h6><i class="fas fa-folder"></i> Organization</h6>
                                    <p>Organize your notes into lists by topic or project for better management and quick access.</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="tip-item">
                                    <h6><i class="fas fa-bell"></i> Smart Reminders</h6>
                                    <p>Set reminders to get notified about important notes or upcoming deadlines via email.</p>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="tip-item">
                                    <h6><i class="fas fa-paperclip"></i> Rich Attachments</h6>
                                    <p>Attach documents, images, or spreadsheets to your notes for comprehensive reference materials.</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="tip-item">
                                    <h6><i class="fas fa-magic"></i> Auto-Save</h6>
                                    <p>Your work is automatically saved as you type. Never lose your important thoughts again!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auto-save indicator -->
    <div class="auto-save-indicator" id="autoSaveIndicator">
        <i class="fas fa-check-circle"></i> Draft saved
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Enhanced animations and interactions
        document.addEventListener('DOMContentLoaded', function() {
            // Form fields animation
            const formGroups = document.querySelectorAll('.modern-form-group');
            formGroups.forEach((group, index) => {
                group.style.opacity = '0';
                group.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    group.style.transition = 'all 0.6s ease';
                    group.style.opacity = '1';
                    group.style.transform = 'translateY(0)';
                }, index * 100);
            });

            // Enhanced input focus effects
            const inputs = document.querySelectorAll('.modern-input, .modern-select, .modern-textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.style.transform = 'translateY(-3px)';
                    this.parentElement.style.transition = 'transform 0.3s ease';
                });
                
                input.addEventListener('blur', function() {
                    this.parentElement.style.transform = 'translateY(0)';
                });

                // Add typing animation
                input.addEventListener('input', function() {
                    this.style.borderColor = '#667eea';
                    setTimeout(() => {
                        this.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                    }, 300);
                });
            });

            // Button hover enhancements
            const buttons = document.querySelectorAll('.modern-btn');
            buttons.forEach(btn => {
                btn.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-3px) scale(1.05)';
                });
                
                btn.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });

                // Ripple effect
                btn.addEventListener('click', function(e) {
                    const ripple = document.createElement('span');
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;
                    
                    ripple.style.cssText = `
                        position: absolute;
                        width: ${size}px;
                        height: ${size}px;
                        left: ${x}px;
                        top: ${y}px;
                        background: rgba(255, 255, 255, 0.3);
                        border-radius: 50%;
                        transform: scale(0);
                        animation: ripple 0.6s ease-out;
                        pointer-events: none;
                    `;
                    
                    this.style.position = 'relative';
                    this.appendChild(ripple);
                    
                    setTimeout(() => ripple.remove(), 600);
                });
            });
        });

        // Enhanced Character counter for content field
        const contentField = document.getElementById('{{ form.content.id_for_label }}');
        const contentCounter = document.getElementById('contentCounter');
        
        function updateContentCounter() {
            const count = contentField.value.length;
            contentCounter.textContent = `${count} characters`;
            
            if (count > 1000) {
                contentCounter.classList.add('warning');
                contentCounter.textContent = `${count} characters (getting long!)`;
            } else {
                contentCounter.classList.remove('warning');
            }

            // Auto-resize textarea
            contentField.style.height = 'auto';
            contentField.style.height = Math.max(150, contentField.scrollHeight) + 'px';
        }
        
        contentField.addEventListener('input', updateContentCounter);
        updateContentCounter(); // Initial count

        // Enhanced File upload functionality
        const fileInput = document.getElementById('{{ form.attachment.id_for_label }}');
        const fileUploadArea = document.getElementById('fileUploadArea');
        const fileSizeInfo = document.getElementById('fileSizeInfo');
        const fileSizeText = document.getElementById('fileSizeText');
        
        // Drag and drop functionality
        fileUploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });

        fileUploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });

        fileUploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileSelection(files[0]);
            }
        });

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                handleFileSelection(file);
            }
        });

        function handleFileSelection(file) {
            const sizeInKB = (file.size / 1024).toFixed(2);
            const sizeInMB = (file.size / (1024 * 1024)).toFixed(2);
            
            fileSizeInfo.style.display = 'block';
            
            if (file.size > 500 * 1024) { // 500KB
                fileSizeText.innerHTML = `<i class="fas fa-exclamation-triangle"></i> File size: ${sizeInKB} KB (${sizeInMB} MB) - Too large! Maximum allowed: 500KB`;
                fileSizeInfo.className = 'text-danger';
                fileInput.setCustomValidity('File size must be less than 500KB');
                
                // Shake animation for error
                fileSizeInfo.style.animation = 'shake 0.5s ease-in-out';
                setTimeout(() => {
                    fileSizeInfo.style.animation = '';
                }, 500);
            } else {
                fileSizeText.innerHTML = `<i class="fas fa-check"></i> File size: ${sizeInKB} KB (${sizeInMB} MB) - Perfect!`;
                fileSizeInfo.className = 'text-success';
                fileInput.setCustomValidity('');
            }

            // Update upload area
            const customLabel = fileUploadArea.querySelector('.custom-file-label');
            customLabel.innerHTML = `
                <div>
                    <i class="fas fa-file"></i>
                    <div style="margin-top: 0.5rem;">${file.name}</div>
                    <small style="color: rgba(255,255,255,0.7);">Click to change file</small>
                </div>
            `;
        }

        // Add shake animation CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes ripple {
                to {
                    transform: scale(2);
                    opacity: 0;
                }
            }
            
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);

        // Enhanced Bootstrap form validation
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        const submitBtn = document.getElementById('submitBtn');
                        
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                            
                            // Shake invalid fields
                            const invalidFields = form.querySelectorAll(':invalid');
                            invalidFields.forEach(field => {
                                field.style.animation = 'shake 0.5s ease-in-out';
                                setTimeout(() => {
                                    field.style.animation = '';
                                }, 500);
                            });
                        } else {
                            // Add loading state
                            submitBtn.classList.add('loading-btn');
                            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                            submitBtn.disabled = true;
                            
                            // Clear draft when successfully submitting
                            localStorage.removeItem('note_draft');
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();

        // Enhanced Auto-save draft functionality
        let autoSaveTimer;
        const autoSaveIndicator = document.getElementById('autoSaveIndicator');
        const formFields = ['{{ form.heading.id_for_label }}', '{{ form.content.id_for_label }}'];
        
        formFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('input', function() {
                    clearTimeout(autoSaveTimer);
                    autoSaveTimer = setTimeout(saveDraft, 2000); // Save after 2 seconds of inactivity
                });
            }
        });
        
        function saveDraft() {
            const draftData = {
                heading: document.getElementById('{{ form.heading.id_for_label }}').value,
                content: document.getElementById('{{ form.content.id_for_label }}').value,
                timestamp: new Date().toISOString()
            };
            
            if (draftData.heading.trim() || draftData.content.trim()) {
                localStorage.setItem('note_draft', JSON.stringify(draftData));
                showAutoSaveIndicator();
            }
        }
        
        function showAutoSaveIndicator() {
            autoSaveIndicator.classList.add('show');
            setTimeout(() => {
                autoSaveIndicator.classList.remove('show');
            }, 2000);
        }
        
        // Load draft on page load
        window.addEventListener('load', function() {
            const draft = localStorage.getItem('note_draft');
            if (draft && !{{ note|yesno:"true,false" }}) { // Only for new notes
                const draftData = JSON.parse(draft);
                const now = new Date();
                const draftTime = new Date(draftData.timestamp);
                const hoursDiff = (now - draftTime) / (1000 * 60 * 60);
                
                if (hoursDiff < 24 && (draftData.heading.trim() || draftData.content.trim())) { // Draft is less than 24 hours old and not empty
                    // Create custom confirmation modal
                    showDraftRestoreModal(draftData);
                }
            }
        });

        function showDraftRestoreModal(draftData) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(10px);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: var(--glass-bg);
                    backdrop-filter: blur(20px);
                    border: 1px solid var(--glass-border);
                    border-radius: 24px;
                    padding: 2rem;
                    max-width: 500px;
                    width: 90%;
                    color: white;
                    text-align: center;
                    box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
                    animation: slideIn 0.3s ease;
                ">
                    <i class="fas fa-save" style="font-size: 3rem; color: #4facfe; margin-bottom: 1rem;"></i>
                    <h4 style="margin-bottom: 1rem;">Draft Found!</h4>
                    <p style="margin-bottom: 2rem; color: rgba(255,255,255,0.8);">
                        We found a draft from ${new Date(draftData.timestamp).toLocaleString()}. 
                        Would you like to restore it?
                    </p>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button onclick="restoreDraft('${encodeURIComponent(JSON.stringify(draftData))}'); this.closest('div').parentElement.parentElement.remove();" 
                                style="background: var(--success-gradient); color: white; border: none; padding: 1rem 2rem; border-radius: 50px; font-weight: 600; cursor: pointer;">
                            <i class="fas fa-check"></i> Restore Draft
                        </button>
                        <button onclick="localStorage.removeItem('note_draft'); this.closest('div').parentElement.parentElement.remove();" 
                                style="background: transparent; color: white; border: 2px solid rgba(255,255,255,0.3); padding: 1rem 2rem; border-radius: 50px; font-weight: 600; cursor: pointer;">
                            <i class="fas fa-times"></i> Discard
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add CSS for animations
            const modalStyle = document.createElement('style');
            modalStyle.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideIn {
                    from { transform: scale(0.8) translateY(-20px); opacity: 0; }
                    to { transform: scale(1) translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(modalStyle);
        }

        function restoreDraft(encodedData) {
            const draftData = JSON.parse(decodeURIComponent(encodedData));
            document.getElementById('{{ form.heading.id_for_label }}').value = draftData.heading;
            document.getElementById('{{ form.content.id_for_label }}').value = draftData.content;
            updateContentCounter();
            
            // Show success message
            showAutoSaveIndicator();
        }

        // Enhanced navbar interactions
        const navLinks = document.querySelectorAll('.nav-link');
        navLinks.forEach(link => {
            link.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-2px)';
            });
            
            link.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // Smooth scroll enhancement
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>