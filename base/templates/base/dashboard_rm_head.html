{% extends "base/base.html" %}
{% load static %}

{% block title %}RM Head Dashboard{% endblock %}

{% block content %}
<h2>Welcome, {{ user.get_full_name|default:user.username }} (RM Head)</h2>

<div class="dashboard-summary" style="display:flex; gap:20px; margin-bottom:30px;">
    <div class="summary-box" style="padding:20px; background:#e3f2fd; border-radius:8px; flex:1; text-align:center;">
        <h3>Total Leads (Team + Self)</h3>
        <p style="font-size: 2.5rem; font-weight:bold; color:#1565c0;">{{ total_leads }}</p>
    </div>
    <div class="summary-box" style="padding:20px; background:#e8f5e9; border-radius:8px; flex:1; text-align:center;">
        <h3>Open Tasks</h3>
        <p style="font-size: 2.5rem; font-weight:bold; color:#2e7d32;">{{ open_tasks }}</p>
    </div>
    <div class="summary-box" style="padding:20px; background:#fff3e0; border-radius:8px; flex:1; text-align:center;">
        <h3>Pending Service Requests</h3>
        <p style="font-size: 2.5rem; font-weight:bold; color:#ef6c00;">{{ pending_service_requests }}</p>
    </div>
</div>

<h3>Team Leads Breakdown</h3>

<table border="1" cellpadding="10" cellspacing="0" width="100%" style="border-collapse: collapse;">
    <thead style="background-color:#90caf9;">
        <tr>
            <th>Relationship Manager</th>
            <th>Total Leads</th>
            <th>Open Tasks</th>
            <th>Pending Service Requests</th>
        </tr>
    </thead>
    <tbody>
        {% for rm in team_rms %}
        <tr>
            <td>{{ rm.get_full_name|default:rm.username }}</td>
            <td>{{ rm.leads_count }}</td>
            <td>{{ rm.open_tasks_count }}</td>
            <td>{{ rm.pending_service_requests_count }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4" style="text-align:center;">No team RM data found.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div style="margin-top: 30px;">
    <a href="{% url 'lead_list' %}">View All Leads</a> |
    <a href="{% url 'task_list' %}">View All Tasks</a> |
    <a href="{% url 'service_request_list' %}">View Service Requests</a>
</div>

{% endblock %}
